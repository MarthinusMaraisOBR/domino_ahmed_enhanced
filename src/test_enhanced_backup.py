            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
#!/usr/bin/env python3
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
# SPDX-FileCopyrightText: Copyright (c) 2023 - 2024 NVIDIA CORPORATION & AFFILIATES.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
# SPDX-License-Identifier: Apache-2.0
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
"""
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
FIXED Enhanced DoMINO model testing with mesh interpolation.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
This script handles coarse and fine meshes with different resolutions by
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
interpolating fine data onto the coarse mesh for proper comparison.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
CRITICAL FIX:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
- Interpolates fine ground truth data onto coarse mesh coordinates
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
- Ensures all field arrays have matching dimensions
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
- Proper handling of different mesh resolutions
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
"""
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import os
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import re
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import time
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import numpy as np
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from pathlib import Path
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import hydra
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from hydra.utils import to_absolute_path
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from omegaconf import DictConfig, OmegaConf
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import torch
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from torch.nn.parallel import DistributedDataParallel
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import vtk
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from vtk.util import numpy_support
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
import pyvista as pv
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from scipy.spatial import cKDTree
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from physicsnemo.distributed import DistributedManager
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from physicsnemo.utils.domino.utils import *
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from physicsnemo.utils.sdf import signed_distance_field
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
# Import the enhanced model
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
from enhanced_domino_model import DoMINOEnhanced
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
# Constants
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
AIR_DENSITY = 1.205
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
STREAM_VELOCITY = 30.0
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def convert_point_to_cell_data_manual(mesh, field_name, n_components=1):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Manually convert point data to cell data using weighted averaging.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"    Manual conversion: {field_name} ({n_components} components)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Get point data
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    point_data = np.array(mesh.point_data[field_name], dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Get connectivity for each cell
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    n_cells = mesh.n_cells
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    cell_data = np.zeros((n_cells, n_components), dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for cell_id in range(n_cells):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Get points for this cell
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        cell = mesh.GetCell(cell_id)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        point_ids = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        for i in range(cell.GetNumberOfPoints()):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            point_ids.append(cell.GetPointId(i))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Average the point data for this cell
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if n_components == 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            cell_data[cell_id] = np.mean(point_data[point_ids])
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            cell_data[cell_id] = np.mean(point_data[point_ids], axis=0)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    return cell_data
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def interpolate_fine_to_coarse(fine_coords, fine_fields, coarse_coords, k_neighbors=4):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Interpolate fine mesh data to coarse mesh using nearest neighbor interpolation.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Args:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        fine_coords: Fine mesh coordinates (N_fine, 3)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        fine_fields: Fine mesh field values (N_fine, n_fields)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        coarse_coords: Coarse mesh coordinates (N_coarse, 3)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        k_neighbors: Number of nearest neighbors for interpolation
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Returns:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        Interpolated field values on coarse mesh (N_coarse, n_fields)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Interpolating fine data ({fine_coords.shape[0]} cells) to coarse mesh ({coarse_coords.shape[0]} cells)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Build KDTree for fine mesh
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    tree = cKDTree(fine_coords)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Find k nearest neighbors for each coarse mesh point
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    distances, indices = tree.query(coarse_coords, k=k_neighbors)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Avoid division by zero
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    distances = np.maximum(distances, 1e-10)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Compute inverse distance weights
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    weights = 1.0 / distances
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    weights = weights / weights.sum(axis=1, keepdims=True)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Interpolate fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    interpolated = np.zeros((coarse_coords.shape[0], fine_fields.shape[1]))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for i in range(k_neighbors):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        interpolated += weights[:, i:i+1] * fine_fields[indices[:, i]]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ Interpolation complete")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    return interpolated.astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def load_coarse_vtp_data_robust(vtp_path, surface_variables):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Load coarse resolution VTP data with robust field extraction.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"Loading coarse data: {vtp_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Read VTP file
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    mesh = pv.read(str(vtp_path))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Coarse mesh: {mesh.n_cells} cells, {mesh.n_points} points")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Cell data keys: {list(mesh.cell_data.keys())}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Point data keys: {list(mesh.point_data.keys())}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Variable name mapping for coarse data
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    variable_mapping = {
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'pMean': ['p', 'pressure', 'Pressure'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'wallShearStressMean': ['wallShearStress', 'WallShearStress', 'tau_wall']
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    }
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Extract fields with proper conversion
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_fields = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    field_info = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for var_name in surface_variables:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        field_found = False
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        possible_names = variable_mapping.get(var_name, [var_name])
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Try each possible name
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        for candidate_name in possible_names:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Check cell data first (preferred)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if candidate_name in mesh.cell_data:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_data = np.array(mesh.cell_data[candidate_name], dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if field_data.ndim == 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    field_data = field_data.reshape(-1, 1)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(field_data)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_info.append(f"{var_name} -> {candidate_name} (cell data)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_found = True
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                break
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Check point data (needs conversion)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            elif candidate_name in mesh.point_data:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"  Converting {candidate_name} from point data to cell data...")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Determine number of components
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                point_array = mesh.point_data[candidate_name]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if hasattr(point_array, 'shape') and len(point_array.shape) > 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    n_components = point_array.shape[1]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                elif 'pressure' in candidate_name.lower() or 'p' == candidate_name.lower():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    n_components = 1
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    n_components = 3  # Assume vector for shear stress
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Convert using manual method
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_data = convert_point_to_cell_data_manual(mesh, candidate_name, n_components)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if field_data.ndim == 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    field_data = field_data.reshape(-1, 1)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(field_data.astype(np.float32))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_info.append(f"{var_name} -> {candidate_name} (point->cell manual)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_found = True
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                break
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if not field_found:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"  Warning: Variable {var_name} not found with any candidate names")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Create zeros as fallback
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            num_cells = mesh.n_cells
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if 'pressure' in var_name.lower() or 'p' in var_name.lower():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(np.zeros((num_cells, 1), dtype=np.float32))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(np.zeros((num_cells, 3), dtype=np.float32))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            field_info.append(f"{var_name} -> ZEROS (not found)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Combine all surface fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    if surface_fields:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        surface_fields_combined = np.concatenate(surface_fields, axis=1).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        raise ValueError("No surface fields could be extracted!")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Get mesh geometry data (ensure float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_coordinates = np.array(mesh.cell_centers().points, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_normals = np.array(mesh.cell_normals, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Compute surface areas
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_sizes = mesh.compute_cell_sizes(length=False, area=True, volume=False)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_areas = np.array(surface_sizes.cell_data["Area"], dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Normalize surface normals
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    norms = np.linalg.norm(surface_normals, axis=1, keepdims=True)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_normals = (surface_normals / norms).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ Loaded {len(surface_coordinates)} cells")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Coarse surface fields shape: {surface_fields_combined.shape}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for info in field_info:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"    {info}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    return {
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'coordinates': surface_coordinates,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'fields': surface_fields_combined,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'normals': surface_normals,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'areas': surface_areas,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'mesh': mesh,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'field_info': field_info
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    }
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def load_fine_vtp_data_and_interpolate(vtp_path, surface_variables, target_coordinates):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Load fine resolution VTP data and interpolate to target coordinates.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Args:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        vtp_path: Path to fine VTP file
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        surface_variables: List of variable names to extract
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        target_coordinates: Target coordinates for interpolation (N_target, 3)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Returns:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        Dictionary with interpolated fine surface data (all float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"Loading fine ground truth data: {vtp_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Read VTP file
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    mesh = pv.read(str(vtp_path))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Fine mesh: {mesh.n_cells} cells, {mesh.n_points} points")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Cell data keys: {list(mesh.cell_data.keys())}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Point data keys: {list(mesh.point_data.keys())}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Variable name mapping for fine data
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    variable_mapping = {
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'pMean': ['pMean', 'pressure', 'Pressure'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'wallShearStressMean': ['wallShearStressMean', 'wallShearStress', 'WallShearStress']
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    }
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Extract fields with proper conversion
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_fields = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    field_info = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for var_name in surface_variables:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        field_found = False
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        possible_names = variable_mapping.get(var_name, [var_name])
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Try each possible name
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        for candidate_name in possible_names:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Check cell data first (preferred)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if candidate_name in mesh.cell_data:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_data = np.array(mesh.cell_data[candidate_name], dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if field_data.ndim == 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    field_data = field_data.reshape(-1, 1)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(field_data)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_info.append(f"{var_name} -> {candidate_name} (cell data)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_found = True
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                break
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Check point data (needs conversion)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            elif candidate_name in mesh.point_data:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"  Converting {candidate_name} from point data to cell data...")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Determine number of components
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                point_array = mesh.point_data[candidate_name]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if hasattr(point_array, 'shape') and len(point_array.shape) > 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    n_components = point_array.shape[1]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                elif 'pressure' in candidate_name.lower() or 'p' == candidate_name.lower():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    n_components = 1
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    n_components = 3  # Assume vector for shear stress
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Convert using manual method
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_data = convert_point_to_cell_data_manual(mesh, candidate_name, n_components)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if field_data.ndim == 1:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    field_data = field_data.reshape(-1, 1)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(field_data.astype(np.float32))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_info.append(f"{var_name} -> {candidate_name} (point->cell manual)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                field_found = True
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                break
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if not field_found:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"  Warning: Variable {var_name} not found with any candidate names")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Create zeros as fallback
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            num_cells = mesh.n_cells
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if 'pressure' in var_name.lower() or 'p' in var_name.lower():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(np.zeros((num_cells, 1), dtype=np.float32))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_fields.append(np.zeros((num_cells, 3), dtype=np.float32))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            field_info.append(f"{var_name} -> ZEROS (not found)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Combine all surface fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    if surface_fields:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        surface_fields_combined = np.concatenate(surface_fields, axis=1).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        raise ValueError("No surface fields could be extracted!")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Get fine mesh geometry data
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_coordinates = np.array(mesh.cell_centers().points, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Interpolate fine fields to target coordinates
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    interpolated_fields = interpolate_fine_to_coarse(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        fine_coords=fine_coordinates,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        fine_fields=surface_fields_combined,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        coarse_coords=target_coordinates,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        k_neighbors=4
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ Interpolated fine data to target mesh")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Interpolated fields shape: {interpolated_fields.shape}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for info in field_info:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"    {info}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    return {
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'fields': interpolated_fields,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'field_info': field_info,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'original_coordinates': fine_coordinates,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        'original_fields': surface_fields_combined
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    }
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def test_enhanced_model(data_dict, model, device, cfg, surf_factors):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Test the enhanced model with STRICT float32 type enforcement.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    with torch.no_grad():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # CRITICAL: Ensure ALL data is float32 and on correct device
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        data_dict_gpu = {}
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        for k, v in data_dict.items():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if isinstance(v, np.ndarray):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Convert to float32 tensor and move to device
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                v_tensor = torch.from_numpy(v.astype(np.float32)).unsqueeze(0).to(device, dtype=torch.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                data_dict_gpu[k] = v_tensor
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                data_dict_gpu[k] = v
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Verify all tensors are float32
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        for k, v in data_dict_gpu.items():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if isinstance(v, torch.Tensor):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if v.dtype != torch.float32:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    print(f"WARNING: Converting {k} from {v.dtype} to float32")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    data_dict_gpu[k] = v.to(dtype=torch.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Get predictions
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        _, prediction_surf = model(data_dict_gpu)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if prediction_surf is not None and surf_factors is not None:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Unnormalize predictions
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            prediction_surf = unnormalize(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                prediction_surf.cpu().numpy(),
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surf_factors[0],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surf_factors[1]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Scale by physical parameters
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            stream_velocity = data_dict_gpu["stream_velocity"][0, 0].cpu().numpy()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            air_density = data_dict_gpu["air_density"][0, 0].cpu().numpy()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            prediction_surf = (
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                prediction_surf * stream_velocity**2.0 * air_density
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    return prediction_surf
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def save_comprehensive_vtp(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    output_path: str,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    base_mesh: pv.PolyData,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_fields: np.ndarray,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_fields_interpolated: np.ndarray,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    predicted_fields: np.ndarray,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_variable_names: list,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_info: list,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_info: list
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    Save VTP file with coarse, fine (interpolated), and predicted fields.
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    """
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"Saving comprehensive VTP: {output_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Create output mesh
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out = base_mesh.copy()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Verify all arrays have the same length
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    n_cells = len(coarse_fields)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    assert len(fine_fields_interpolated) == n_cells, f"Size mismatch: fine {len(fine_fields_interpolated)} vs coarse {n_cells}"
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    assert len(predicted_fields) == n_cells, f"Size mismatch: predicted {len(predicted_fields)} vs coarse {n_cells}"
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  All field arrays have {n_cells} cells - dimensions match ✅")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add coarse fields (input data)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_pressure = coarse_fields[:, 0:1]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_wall_shear = coarse_fields[:, 1:4]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add coarse pressure
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_pressure_vtk = numpy_support.numpy_to_vtk(coarse_pressure)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_pressure_vtk.SetName("Coarse_Pressure")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(coarse_pressure_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add coarse wall shear stress
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_shear_vtk = numpy_support.numpy_to_vtk(coarse_wall_shear)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_shear_vtk.SetName("Coarse_WallShearStress")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(coarse_shear_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add fine fields (interpolated ground truth)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_pressure = fine_fields_interpolated[:, 0:1]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_wall_shear = fine_fields_interpolated[:, 1:4]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add fine pressure
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_pressure_vtk = numpy_support.numpy_to_vtk(fine_pressure)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_pressure_vtk.SetName("Fine_Pressure_GroundTruth_Interpolated")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(fine_pressure_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add fine wall shear stress
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_shear_vtk = numpy_support.numpy_to_vtk(fine_wall_shear)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_shear_vtk.SetName("Fine_WallShearStress_GroundTruth_Interpolated")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(fine_shear_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add predicted fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pred_pressure = predicted_fields[:, 0:1]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pred_wall_shear = predicted_fields[:, 1:4]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add predicted pressure
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pred_pressure_vtk = numpy_support.numpy_to_vtk(pred_pressure)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pred_pressure_vtk.SetName("Predicted_Pressure")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(pred_pressure_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add predicted wall shear stress
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pred_shear_vtk = numpy_support.numpy_to_vtk(pred_wall_shear)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pred_shear_vtk.SetName("Predicted_WallShearStress")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(pred_shear_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Calculate error fields (predicted vs fine ground truth)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pressure_error = pred_pressure - fine_pressure
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    shear_error = pred_wall_shear - fine_wall_shear
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add error fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pressure_error_vtk = numpy_support.numpy_to_vtk(pressure_error)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    pressure_error_vtk.SetName("Error_Pressure_vs_Fine")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(pressure_error_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    shear_error_vtk = numpy_support.numpy_to_vtk(shear_error)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    shear_error_vtk.SetName("Error_WallShearStress_vs_Fine")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(shear_error_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Calculate improvement over coarse baseline
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_pressure_error = coarse_pressure - fine_pressure
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_shear_error = coarse_wall_shear - fine_wall_shear
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Add coarse baseline error fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_pressure_error_vtk = numpy_support.numpy_to_vtk(coarse_pressure_error)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_pressure_error_vtk.SetName("Error_Coarse_vs_Fine")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(coarse_pressure_error_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_shear_error_vtk = numpy_support.numpy_to_vtk(coarse_shear_error)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_shear_error_vtk.SetName("Error_CoarseShear_vs_Fine")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(coarse_shear_error_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Calculate relative error fields (as percentages)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Avoid division by zero
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_pressure_safe = np.where(np.abs(fine_pressure) < 1e-10, 1e-10, fine_pressure)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_shear_safe = np.where(np.abs(fine_wall_shear) < 1e-10, 1e-10, fine_wall_shear)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    rel_pressure_error = 100.0 * pressure_error / fine_pressure_safe
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    rel_shear_error = 100.0 * shear_error / fine_shear_safe
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    rel_pressure_error_vtk = numpy_support.numpy_to_vtk(rel_pressure_error)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    rel_pressure_error_vtk.SetName("RelativeError_Pressure_Percent")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(rel_pressure_error_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    rel_shear_error_vtk = numpy_support.numpy_to_vtk(rel_shear_error)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    rel_shear_error_vtk.SetName("RelativeError_WallShearStress_Percent")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    polydata_out.GetCellData().AddArray(rel_shear_error_vtk)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Write VTP file
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    write_to_vtp(polydata_out, output_path)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ Saved comprehensive VTP with {polydata_out.GetCellData().GetNumberOfArrays()} field arrays")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  Field arrays:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for i in range(polydata_out.GetCellData().GetNumberOfArrays()):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        array_name = polydata_out.GetCellData().GetArrayName(i)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"    - {array_name}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
@hydra.main(version_base="1.3", config_path="conf", config_name="config")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
def main(cfg: DictConfig):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("="*80)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("ENHANCED DoMINO MODEL TESTING - MESH INTERPOLATION FIXED")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("="*80)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("Saving: Coarse + Fine (Interpolated) + Predicted + Error Fields")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Initialize distributed manager
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    DistributedManager.initialize()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    dist = DistributedManager()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"Config summary:\n{OmegaConf.to_yaml(cfg, sort_keys=True)}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Verify enhanced mode is enabled
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    if not cfg.data_processor.get('use_enhanced_features', False):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print("ERROR: Enhanced features not enabled in config!")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print("Set 'use_enhanced_features: true' in config.yaml")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        return
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Get paths
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_test_path = cfg.eval.get('coarse_test_path', '/data/ahmed_data/organized/test/coarse/')
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    fine_test_path = cfg.eval.get('test_path', '/data/ahmed_data/organized/test/fine/')
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    save_path = cfg.eval.save_path
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Create save directory
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    if dist.rank == 0:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        Path(save_path).mkdir(parents=True, exist_ok=True)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Model configuration
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    model_type = cfg.model.model_type
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Surface variables
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surface_variable_names = list(cfg.variables.surface.solution.keys())
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    num_surf_vars = 0
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for j in surface_variable_names:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if cfg.variables.surface.solution[j] == "vector":
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            num_surf_vars += 3
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            num_surf_vars += 1
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Load scaling factors
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    surf_save_path = os.path.join(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        cfg.eval.scaling_param_path, "surface_scaling_factors_inference.npy"
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    if os.path.exists(surf_save_path):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        surf_factors = np.load(surf_save_path).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"Loaded surface scaling factors: {surf_factors}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        surf_factors = None
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print("Warning: No surface scaling factors found")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Create enhanced model with explicit float32
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("\nCreating Enhanced DoMINO model...")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    model = DoMINOEnhanced(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        input_features=3,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        output_features_vol=None,  # Surface only for Ahmed
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        output_features_surf=num_surf_vars,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        model_parameters=cfg.model,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    ).to(dist.device, dtype=torch.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    model = torch.compile(model, disable=True)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Load checkpoint
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    checkpoint_path = os.path.join(cfg.resume_dir, cfg.eval.checkpoint_name)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"Loading checkpoint: {checkpoint_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    checkpoint = torch.load(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        to_absolute_path(checkpoint_path),
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        map_location=dist.device
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    model.load_state_dict(checkpoint)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    model.eval()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Ensure model parameters are float32
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for param in model.parameters():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if param.dtype != torch.float32:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Converting model parameter from {param.dtype} to float32")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            param.data = param.data.to(dtype=torch.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("Model loaded successfully with float32 parameters")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Get test cases
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    coarse_test_cases = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for case_dir in sorted(Path(coarse_test_path).iterdir()):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        if case_dir.is_dir() and case_dir.name.startswith('run_'):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            coarse_test_cases.append(case_dir.name)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"\nProcessing {len(coarse_test_cases)} test cases")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Process each test case
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    results_summary = []
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    for count, dirname in enumerate(coarse_test_cases[:5]):  # Test first 5 cases
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"\n{'='*60}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"Processing: {dirname} ({count+1}/5)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"{'='*60}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        tag = int(re.findall(r"(\w+?)(\d+)", dirname)[0][1])
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # File paths
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        coarse_filepath = os.path.join(coarse_test_path, dirname)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        fine_filepath = os.path.join(fine_test_path, dirname)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        stl_path = os.path.join(coarse_filepath, f"ahmed_{tag}.stl")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        coarse_vtp_path = os.path.join(coarse_filepath, f"boundary_{tag}.vtp")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        fine_vtp_path = os.path.join(fine_filepath, f"boundary_{tag}.vtp")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Output path
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        vtp_comprehensive_save_path = os.path.join(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            save_path, f"boundary_{tag}_comprehensive_comparison.vtp"
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        try:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Load STL geometry (strict float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Loading geometry: {stl_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            reader = pv.get_reader(stl_path)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            mesh_stl = reader.read()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            stl_vertices = np.array(mesh_stl.points, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            stl_faces = np.array(mesh_stl.faces, dtype=np.int32).reshape((-1, 4))[:, 1:]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            mesh_indices_flattened = stl_faces.flatten().astype(np.int32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            length_scale = float(np.amax(np.amax(stl_vertices, 0) - np.amin(stl_vertices, 0)))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            stl_sizes = mesh_stl.compute_cell_sizes(length=False, area=True, volume=False)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            stl_sizes = np.array(stl_sizes.cell_data["Area"], dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            stl_centers = np.array(mesh_stl.cell_centers().points, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Calculate center of mass
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            center_of_mass = calculate_center_of_mass(stl_centers, stl_sizes).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Set bounding box
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if cfg.data.bounding_box_surface is None:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                s_max = np.amax(stl_vertices, 0).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                s_min = np.amin(stl_vertices, 0).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            else:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                s_max = np.array(cfg.data.bounding_box_surface.max, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                s_min = np.array(cfg.data.bounding_box_surface.min, dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Create grid for SDF (strict float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            nx, ny, nz = cfg.model.interp_res
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surf_grid = create_grid(s_max, s_min, [nx, ny, nz]).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surf_grid_reshaped = surf_grid.reshape(nx * ny * nz, 3).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Calculate SDF with proper data types
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            sdf_surf_grid = signed_distance_field(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                stl_vertices,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                mesh_indices_flattened,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surf_grid_reshaped,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                use_sign_winding_number=True,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            ).reshape(nx, ny, nz).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surf_grid_max_min = np.array([s_min, s_max], dtype=np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Load coarse surface data first (this will be our reference mesh)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Loading coarse surface data: {coarse_vtp_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            coarse_data = load_coarse_vtp_data_robust(coarse_vtp_path, surface_variable_names)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Load fine surface data and interpolate to coarse mesh coordinates
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Loading and interpolating fine surface data: {fine_vtp_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            fine_data = load_fine_vtp_data_and_interpolate(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                fine_vtp_path, 
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_variable_names, 
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                coarse_data['coordinates']  # Use coarse coordinates as target
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Use coarse mesh as reference (since model is trained on coarse→fine)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            reference_mesh = coarse_data['mesh']
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surface_coordinates = coarse_data['coordinates'].astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Prepare surface neighbors (strict float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            interp_func = cKDTree(surface_coordinates)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            dd, ii = interp_func.query(surface_coordinates, k=cfg.eval.stencil_size + 1)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surface_neighbors = surface_coordinates[ii[:, 1:]].astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surface_neighbors_normals = coarse_data['normals'][ii[:, 1:]].astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surface_neighbors_areas = coarse_data['areas'][ii[:, 1:]].astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Calculate positional encoding
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            pos_surface_center_of_mass = (surface_coordinates - center_of_mass).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Normalize coordinates (strict float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surface_coordinates_norm = normalize(surface_coordinates, s_max, s_min).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surface_neighbors_norm = normalize(surface_neighbors, s_max, s_min).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            surf_grid_norm = normalize(surf_grid, s_max, s_min).astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Prepare data dictionary for model (ALL float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            data_dict = {
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "geometry_coordinates": stl_vertices,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surf_grid": surf_grid_norm,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "sdf_surf_grid": sdf_surf_grid,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_mesh_centers": surface_coordinates_norm,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_mesh_neighbors": surface_neighbors_norm,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_normals": coarse_data['normals'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_neighbors_normals": surface_neighbors_normals,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_areas": coarse_data['areas'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_neighbors_areas": surface_neighbors_areas,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_fields": coarse_data['fields'],  # Only coarse features!
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "pos_surface_center_of_mass": pos_surface_center_of_mass,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "surface_min_max": surf_grid_max_min,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "length_scale": np.array([length_scale], dtype=np.float32),
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "stream_velocity": np.array([[STREAM_VELOCITY]], dtype=np.float32),
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                "air_density": np.array([[AIR_DENSITY]], dtype=np.float32),
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            }
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Verify all arrays are float32
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            for k, v in data_dict.items():
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if isinstance(v, np.ndarray) and v.dtype != np.float32:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    print(f"Converting {k} from {v.dtype} to float32")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    data_dict[k] = v.astype(np.float32)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Input surface fields shape: {coarse_data['fields'].shape}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Interpolated fine fields shape: {fine_data['fields'].shape}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print("  (Both should have same number of cells now)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            # Get predictions
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print("Running enhanced model prediction...")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            start_time = time.time()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            prediction_surf = test_enhanced_model(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                data_dict, model, dist.device, cfg, surf_factors
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            elapsed_time = time.time() - start_time
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"Prediction completed in {elapsed_time:.2f} seconds")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            if prediction_surf is not None:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                prediction_surf = prediction_surf[0]  # Remove batch dimension
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Convert tensor to numpy for force calculations
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                if torch.is_tensor(prediction_surf):
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    prediction_surf = prediction_surf.cpu().numpy()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Now all arrays have the same dimensions - calculate forces
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_areas = coarse_data['areas'].reshape(-1, 1)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                surface_normals = coarse_data['normals']
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Coarse forces
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                coarse_force_x = np.sum(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    coarse_data['fields'][:, 0] * surface_normals[:, 0] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    - coarse_data['fields'][:, 1] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                coarse_force_z = np.sum(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    coarse_data['fields'][:, 0] * surface_normals[:, 2] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    - coarse_data['fields'][:, 3] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Fine forces (interpolated ground truth)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                fine_force_x = np.sum(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    fine_data['fields'][:, 0] * surface_normals[:, 0] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    - fine_data['fields'][:, 1] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                fine_force_z = np.sum(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    fine_data['fields'][:, 0] * surface_normals[:, 2] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    - fine_data['fields'][:, 3] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Predicted forces
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pred_force_x = np.sum(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    prediction_surf[:, 0] * surface_normals[:, 0] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    - prediction_surf[:, 1] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pred_force_z = np.sum(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    prediction_surf[:, 0] * surface_normals[:, 2] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    - prediction_surf[:, 3] * surface_areas[:, 0]
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"\nForce Comparison:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"  Drag Forces:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Coarse:       {coarse_force_x:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Fine (Interp): {fine_force_x:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Predicted:    {pred_force_x:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Calculate errors
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                coarse_to_fine_drag_error = abs(coarse_force_x - fine_force_x)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pred_to_fine_drag_error = abs(pred_force_x - fine_force_x)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                drag_improvement = (coarse_to_fine_drag_error - pred_to_fine_drag_error) / coarse_to_fine_drag_error * 100
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Coarse vs Fine error: {coarse_to_fine_drag_error:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Pred vs Fine error:   {pred_to_fine_drag_error:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Improvement: {drag_improvement:.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"  Lift Forces:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Coarse:       {coarse_force_z:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Fine (Interp): {fine_force_z:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Predicted:    {pred_force_z:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Calculate errors
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                coarse_to_fine_lift_error = abs(coarse_force_z - fine_force_z)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pred_to_fine_lift_error = abs(pred_force_z - fine_force_z)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                lift_improvement = (coarse_to_fine_lift_error - pred_to_fine_lift_error) / coarse_to_fine_lift_error * 100
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Coarse vs Fine error: {coarse_to_fine_lift_error:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Pred vs Fine error:   {pred_to_fine_lift_error:.6f} N")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Improvement: {lift_improvement:.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Store results
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                results_summary.append({
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'case': dirname,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'case_number': tag,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'drag_coarse': coarse_force_x,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'drag_fine': fine_force_x,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'drag_pred': pred_force_x,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'drag_improvement': drag_improvement,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'lift_coarse': coarse_force_z,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'lift_fine': fine_force_z,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'lift_pred': pred_force_z,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'lift_improvement': lift_improvement,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    'processing_time': elapsed_time
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                })
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Save comprehensive VTP with all fields
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"Saving comprehensive VTP: {vtp_comprehensive_save_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                save_comprehensive_vtp(
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    output_path=vtp_comprehensive_save_path,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    base_mesh=reference_mesh,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    coarse_fields=coarse_data['fields'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    fine_fields_interpolated=fine_data['fields'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    predicted_fields=prediction_surf,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    surface_variable_names=surface_variable_names,
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    coarse_info=coarse_data['field_info'],
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                    fine_info=fine_data['field_info']
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                )
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Calculate field statistics
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pressure_rmse = np.sqrt(np.mean((prediction_surf[:, 0] - fine_data['fields'][:, 0])**2))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                shear_rmse = np.sqrt(np.mean((prediction_surf[:, 1:4] - fine_data['fields'][:, 1:4])**2))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Calculate baseline errors
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pressure_rmse_baseline = np.sqrt(np.mean((coarse_data['fields'][:, 0] - fine_data['fields'][:, 0])**2))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                shear_rmse_baseline = np.sqrt(np.mean((coarse_data['fields'][:, 1:4] - fine_data['fields'][:, 1:4])**2))
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                # Calculate improvements
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                pressure_improvement = (pressure_rmse_baseline - pressure_rmse) / pressure_rmse_baseline * 100
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                shear_improvement = (shear_rmse_baseline - shear_rmse) / shear_rmse_baseline * 100
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"\nField Quality Metrics:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"  Pressure RMSE:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Coarse baseline: {pressure_rmse_baseline:.6f}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Predicted:       {pressure_rmse:.6f}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Improvement:     {pressure_improvement:.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"  Wall Shear RMSE:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Coarse baseline: {shear_rmse_baseline:.6f}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Predicted:       {shear_rmse:.6f}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                print(f"    Improvement:     {shear_improvement:.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        except Exception as e:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"  ❌ Error processing {dirname}: {str(e)}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            import traceback
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            traceback.print_exc()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            continue
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    # Print comprehensive summary
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"\n{'='*80}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print("ENHANCED MODEL TESTING COMPLETED - COMPREHENSIVE COMPARISON")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"{'='*80}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"Successfully processed: {len(results_summary)}/5 test cases")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    if results_summary:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"\nForce Predictions Comprehensive Summary:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"{'Case':<8} {'Coarse Drag':<12} {'Fine Drag':<12} {'Pred Drag':<12} {'Improvement':<12}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"{'':8} {'Coarse Lift':<12} {'Fine Lift':<12} {'Pred Lift':<12} {'Improvement':<12}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print("-" * 80)
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        for result in results_summary:
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"{result['case']:<8} {result['drag_coarse']:<12.6f} "
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                  f"{result['drag_fine']:<12.6f} {result['drag_pred']:<12.6f} {result['drag_improvement']:<12.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print(f"{'':8} {result['lift_coarse']:<12.6f} "
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
                  f"{result['lift_fine']:<12.6f} {result['lift_pred']:<12.6f} {result['lift_improvement']:<12.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
            print()
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        # Calculate average improvements
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        avg_drag_improvement = np.mean([r['drag_improvement'] for r in results_summary])
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        avg_lift_improvement = np.mean([r['lift_improvement'] for r in results_summary])
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"\n📊 OVERALL PERFORMANCE:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"  Average drag prediction improvement over coarse: {avg_drag_improvement:.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
        print(f"  Average lift prediction improvement over coarse: {avg_lift_improvement:.1f}%")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"\n🎉 Enhanced DoMINO comprehensive testing completed successfully!")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"\n📁 Output VTP files contain:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  - Coarse_Pressure & Coarse_WallShearStress (input)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  - Fine_Pressure_GroundTruth_Interpolated & Fine_WallShearStress_GroundTruth_Interpolated")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  - Predicted_Pressure & Predicted_WallShearStress")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  - Error_Pressure_vs_Fine & Error_WallShearStress_vs_Fine")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  - Error_Coarse_vs_Fine & Error_CoarseShear_vs_Fine (baseline errors)")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  - RelativeError_Pressure_Percent & RelativeError_WallShearStress_Percent")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"\n💡 In ParaView:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  1. Load the VTP files from: {save_path}")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  2. Use 'Coarse_*' fields to see input data")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  3. Use 'Fine_*_GroundTruth_Interpolated' fields to see target data")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  4. Use 'Predicted_*' fields to see model predictions")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  5. Use 'Error_*_vs_Fine' fields to see prediction errors")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  6. Use 'Error_Coarse_vs_Fine' fields to see baseline errors")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  7. Color by different fields to compare visually")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"\n🔧 Key Fix Applied:")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ Fine mesh data interpolated to coarse mesh coordinates")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ All field arrays now have matching dimensions")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    print(f"  ✅ Proper error calculation and improvement metrics")
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']

            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
if __name__ == "__main__":
            # Normalize coarse fields using inference scaling factors
            if surf_factors is not None:
                coarse_fields_normalized = (coarse_data['fields'] - surf_factors[1]) / (surf_factors[0] - surf_factors[1])
            else:
                coarse_fields_normalized = coarse_data['fields']
    main()